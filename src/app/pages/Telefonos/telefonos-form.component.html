<!-- telefonos-form.component.html -->
<!-- HEADER (HOME + T√çTULO + USUARIO) -->
<mat-toolbar class="header-toolbar">
  <button mat-icon-button class="home-icon" routerLink="/gestion">
    <img src="assets/images/casa.png" alt="Home" class="icon-img" />
  </button>
  <span class="title">Tu Pueblo Conecta</span>
  <button mat-icon-button class="user-icon-btn" (click)="toggleUserMenu()">
    <img src="assets/images/SimboloUser.png" alt="Usuario" class="icon-img" />
  </button>
  <div class="user-dropdown" *ngIf="showUserMenu">
    <p class="user-email">{{ userData?.correo || 'usuario@ejemplo.com' }}</p>
    <p class="user-pueblo">Pueblo: {{ userData?.pueblo_gestionado || '‚Äî' }}</p>
    <button mat-button class="logout-btn" (click)="onLogout()">
      Cerrar sesi√≥n
    </button>
  </div>
</mat-toolbar>

<!-- NAVBAR PRINCIPAL -->
<div #navToolbar class="nav-toolbar">
  <button mat-button routerLink="/crear-noticia" routerLinkActive="active" class="nav-link">
    <span class="nav-text">Noticias</span>
  </button>
  <button mat-button routerLink="/deportes" routerLinkActive="active" class="nav-link">
    <span class="nav-text">Deportes</span>
  </button>
  <button mat-button routerLink="/fiestas" routerLinkActive="active" class="nav-link">
    <span class="nav-text">Fiestas</span>
  </button>
  <button mat-button routerLink="/instalaciones" routerLinkActive="active" class="nav-link">
    <span class="nav-text">Instalaciones</span>
  </button>
  <button mat-button routerLink="/empleo" routerLinkActive="active" class="nav-link">
    <span class="nav-text">Empleo</span>
  </button>
  <button mat-button routerLink="/telefonos" routerLinkActive="active" class="nav-link">
    <span class="nav-text">Tel√©fonos</span>
  </button>
  <div class="indicator"></div>
</div>

<!-- CONTENIDO PRINCIPAL: FORMULARIO Y LISTADO JUNTOS -->
<div class="pantalla-container">
  <!-- Panel para crear/editar tel√©fonos -->
  <div class="form-container">
    <h2 class="titulo">{{ editandoId ? 'Editar tel√©fono' : 'A√±adir nuevo tel√©fono' }}</h2>
    
    <!-- Mensaje de √©xito -->
    <div *ngIf="mensajeExito" class="mensaje-exito slide-up">
      <mat-icon>check_circle</mat-icon>
      {{ mensajeExito }}
    </div>

    <form [formGroup]="form" (ngSubmit)="guardarTelefono()">
      <div class="form-field">
        <label class="custom-label">Nombre del lugar</label>
        <input class="custom-input" formControlName="nombre" placeholder="Ej: Ayuntamiento, Centro de Salud, etc." />
        <div *ngIf="form.get('nombre')?.invalid && form.get('nombre')?.touched" class="error-message">
          El nombre es requerido
        </div>
      </div>

      <div class="form-field">
        <label class="custom-label">N√∫mero de tel√©fono</label>
        <input class="custom-input" formControlName="numero" placeholder="Ej: 976123456" maxlength="9" />
        <div *ngIf="form.get('numero')?.invalid && form.get('numero')?.touched" class="error-message">
          <span *ngIf="form.get('numero')?.errors?.['required']">El n√∫mero es requerido</span>
          <span *ngIf="form.get('numero')?.errors?.['pattern']">Debe contener exactamente 9 d√≠gitos</span>
        </div>
      </div>

      <div class="flex gap-2">
        <button 
          mat-raised-button 
          color="primary" 
          type="submit" 
          [disabled]="form.invalid || cargando">
          <span *ngIf="!cargando">
            {{ editandoId ? 'Guardar Cambios' : 'A√±adir Tel√©fono' }}
          </span>
          <span *ngIf="cargando" class="spinner-container">
            <mat-spinner diameter="24" color="accent"></mat-spinner>
            <span>{{ editandoId ? 'Actualizando...' : 'Guardando...' }}</span>
          </span>
        </button>
        <button
          *ngIf="editandoId"
          mat-raised-button
          color="warn"
          type="button"
          (click)="cancelarEdicion()"
        >
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <!-- Panel para listar tel√©fonos -->
  <div class="listado-telefonos">
    <h2 class="titulo">Tel√©fonos registrados</h2>
    
    <div *ngIf="telefonos$ | async as telefonos; else noTelefonos" class="telefonos-grid">
      <div *ngFor="let tel of telefonos" class="telefono-card">
        <div class="telefono-info">
          <h3 class="telefono-nombre">{{ tel.nombre }}</h3>
          <p class="telefono-numero">üìû {{ tel.numero }}</p>
        </div>
        <div class="telefono-acciones">
          <button mat-icon-button color="primary" (click)="editarTelefono(tel)" matTooltip="Editar">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="eliminarTelefono(tel.id)" matTooltip="Eliminar">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <ng-template #noTelefonos>
      <div class="no-data">
        <mat-icon>phone_disabled</mat-icon>
        <p>No hay tel√©fonos registrados a√∫n</p>
        <p class="no-data-subtitle">A√±ade el primer tel√©fono usando el formulario</p>
      </div>
    </ng-template>
  </div>
</div>
